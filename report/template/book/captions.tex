\DeclareCaptionFont{fg}{\color{fg}}
\DeclareCaptionFont{fgacc}{\color{fgacc}}
\DeclareCaptionFormat{listing}{\colorbox{border}{\parbox{\dimexpr\linewidth-2\fboxsep\relax}{##1##2##3}}}
\captionsetup[lstlisting]{
  format=listing,
  labelfont=fgacc,
  textfont=fg,
  singlelinecheck=false,
  margin=0pt,
  font={bf,footnotesize}
}
